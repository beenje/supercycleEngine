record(longin, "$(P)$(R=)Trig-Cnt") {
    field(DESC, "Trigger Counter")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(EGU, "-")
    $(ENEVG=)field(INP, "$(PEVG)Trig CP")
    #$(ENEVG=)field(TSEL, "$(PEVG)Trig.TSEL")

    field(FLNK, "$(P)$(R=)EngineCycle")
}

record(aSub, "$(P)$(R=)EngineCycle") {
    #field(INAM, initEngine)
    field(SNAM, ioEngine)
    field(SCAN, "Passive")
    #alias("$(P)$(R=)IdCycle")
    field(FTVA, "ULONG")
    field(NOVA, "100")
    field(FTVB, "ULONG")
    field(NOVB, "100")
    field(FTVC, "ULONG")
    field(NOVC, "100")
    field(FTVD, "ULONG")
    field(NOVD, "100")

    $(ENEVG=)field(OUTB, "$(PEVG)dbus-send-u32 CP")

    # Alternate
    #$(ENEVG=)field(OUTC, "$(PEVG)SoftSeq0-Timestamp-SP")
    #$(ENEVG=)field(OUTD, "$(PEVG)SoftSeq0-EvtCode-SP")

    field(FLNK, "$(P)$(R=)Trig-FOut_")
}

record(fanout, "$(P)$(R=)Trig-FOut_") {
    field(DESC, "Trigger Fanout")
    field(SELM, "All")
    #field(PINI, "RUNNING")
    field(LNK1, "$(P)$(R=)Sel-Addr_")
    field(LNK2, "$(P)$(R=)IdCycle")
    field(LNK3, "$(P)$(R=)Period")
    field(LNK4, "$(P)$(R=)Databuffer")
    field(LNK5, "$(P)$(R=)Timestamps")
    field(LNK6, "$(P)$(R=)Events")
}

record(int64in, "$(P)$(R=)IdCycle") {
    field(DESC, "ID Cycle")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(EGU, "id")
    field(INP, "$(P)$(R=)EngineCycle.VALA[0]")
    alias("$(P)$(R=)HEARTBEAT")
}

record(longin, "$(P)$(R=)Period") {
    field(DESC, "Actuall Cycle Frequency")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(EGU, "us")
    field(INP, "$(P)$(R=)EngineCycle.VALA[2]")

    #field(FLNK, "$(P)$(R=)Seq0-En-Cmd CP NMS")
    #field(HIHI, "2000000") #0.5Hz
	#field(HIGH, "80000")
	#field(LOW,  "70000")
	#field(LOLO, "10000") #100Hz
    #field(HHSV, "MAJOR")
	#field(HSV,  "MINOR")
	#field(LSV,  "MINOR")
	#field(LLSV, "MAJOR")
}

#record(longin, "$(P)$(R=)Sync-lIn_") {
#    field(DESC, "SC End EVT")
#    field(SCAN, "Passive")
#    field(INP, "$(P)$(R=)EngineCycle.VALA[3]")
#}

record(waveform, "$(P)$(R=)Databuffer") {
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(FTVL, "ULONG")
    field(INP, "$(P)$(R=)EngineCycle.VALB")
    #field(INDX, "0")
    field(NELM, "2046") # "2046")
    #field(MALM, "2046") # "2046")
    #alias("$(P)$(R=)Dbuf")
}

record(waveform, "$(P)$(R=)Timestamps") {
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(FTVL, "ULONG")
    field(INP, "$(P)$(R=)EngineCycle.VALC")
    #field(INDX, "0")
    field(NELM, "2046") # "2046")
    #field(MALM, "2046") # "2046")
    #alias("$(P)$(R=)Tst")
}

record(waveform, "$(P)$(R=)Events") {
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(FTVL, "ULONG")
    field(INP, "$(P)$(R=)EngineCycle.VALD")
    #field(INDX, "0")
    field(NELM, "2046") # "2046")
    #field(MALM, "2046") # "2046")
    #alias("$(P)$(R=)Evt")
}

record(calcout, "$(P)$(R=)Sel-Addr_") {
    field(DESC, "Select Address")
    field(CALC, "(A<1)?A+1:0")
    field(SCAN, "Passive")
    field(INPA, "$(P)$(R=)Sel-Addr_")
    field(FLNK, "$(P)$(R=)Sel-Mask_")
}

record(calcout, "$(P)$(R=)Sel-Mask_") {
    field(DESC, "Select Address")
    field(CALC, "(A>0)?0xFF00:0xFF")
    field(SCAN, "Passive")
    field(INPA, "$(P)$(R=)Sel-Addr_")

    field(FLNK, "$(P)$(R=)Seq-Sel-FOut_")
}

#==========

record(fanout, "$(P)$(R=)Seq-Sel-FOut_") {
    field(DESC, "Seq Selector Fanout")
    field(SELM, "Mask")
    field(SELL, "$(P)$(R=)Sel-Mask_")
    #field(PINI, "RUNNING")
    field(LNK1, "$(P)$(R=)Seq0-Tst-aSubBuf_")
    field(LNK2, "$(P)$(R=)Seq0-Evt-aSubBuf_")
    field(LNK8, "$(P)$(R=)Seq1-Tst-aSubBuf_")
    field(LNK9, "$(P)$(R=)Seq1-Evt-aSubBuf_")
}

record(aSub, "$(P)$(R=)Seq0-Tst-aSubBuf_") {
    field(DESC, "Timestamp Array Buffer")
    field(SNAM, ioASubBuf)
    field(SCAN, "Passive")
    #alias("$(P)$(R=)IdCycle")
    field(FTA, "ULONG")
    field(NOA, "100")
    field(FTVA, "ULONG")
    field(NOVA, "100")

    field(INPA, "$(P)$(R=)EngineCycle.VALC")
    $(ENEVG=)field(OUTA, "$(PEVG)SoftSeq0-Timestamp-SP CP")

    #field(FLNK, "$(P)$(R=)Evt-DMux-aSub_")
}

record(aSub, "$(P)$(R=)Seq0-Evt-aSubBuf_") {
    field(DESC, "Timestamp Array Buffer")
    field(SNAM, ioASubBuf)
    field(SCAN, "Passive")
    #alias("$(P)$(R=)IdCycle")
    field(FTA, "ULONG")
    field(NOA, "100")
    field(FTVA, "ULONG")
    field(NOVA, "100")

    field(INPA, "$(P)$(R=)EngineCycle.VALD")
    $(ENEVG=)field(OUTA, "$(PEVG)SoftSeq0-EvtCode-SP CP")

    field(FLNK, "$(P)$(R=)Seq0-Ctrl-FOut_")
}

record(aSub, "$(P)$(R=)Seq1-Tst-aSubBuf_") {
    field(DESC, "Timestamp Array Buffer")
    field(SNAM, ioASubBuf)
    field(SCAN, "Passive")
    #alias("$(P)$(R=)IdCycle")
    field(FTA, "ULONG")
    field(NOA, "100")
    field(FTVA, "ULONG")
    field(NOVA, "100")

    field(INPA, "$(P)$(R=)EngineCycle.VALC")
    $(ENEVG=)field(OUTA, "$(PEVG)SoftSeq1-Timestamp-SP CP")

    #field(FLNK, "$(P)$(R=)Seq1-Ctrl-FOut_")
}

record(aSub, "$(P)$(R=)Seq1-Evt-aSubBuf_") {
    field(DESC, "Timestamp Array Buffer")
    field(SNAM, ioASubBuf)
    field(SCAN, "Passive")
    #alias("$(P)$(R=)IdCycle")
    field(FTA, "ULONG")
    field(NOA, "100")
    field(FTVA, "ULONG")
    field(NOVA, "100")

    field(INPA, "$(P)$(R=)EngineCycle.VALD")
    $(ENEVG=)field(OUTA, "$(PEVG)SoftSeq1-EvtCode-SP CP")

    field(FLNK, "$(P)$(R=)Seq1-Ctrl-FOut_")
}

record(fanout, "$(P)$(R=)Seq0-Ctrl-FOut_") {
    field(DESC, "Seq Selector Fanout")
    field(SELM, "All")
    #field(PINI, "RUNNING")
    $(ENEVG=)field(LNK1, "$(PEVG)SoftSeq1-Disable-Cmd CP")
    $(ENEVG=)field(LNK2, "$(PEVG)SoftSeq0-Commit-Cmd CP")
    $(ENEVG=)field(LNK3, "$(PEVG)SoftSeq0-Enable-Cmd CP")
}

record(fanout, "$(P)$(R=)Seq1-Ctrl-FOut_") {
    field(DESC, "Seq Selector Fanout")
    field(SELM, "All")
    #field(PINI, "RUNNING")
    $(ENEVG=)field(LNK1, "$(PEVG)SoftSeq0-Disable-Cmd CP")
    $(ENEVG=)field(LNK2, "$(PEVG)SoftSeq1-Commit-Cmd CP")
    $(ENEVG=)field(LNK3, "$(PEVG)SoftSeq1-Enable-Cmd CP")
}

